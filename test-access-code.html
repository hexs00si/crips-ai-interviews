<!DOCTYPE html>
<html>
<head>
    <title>Test Access Code Query</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Test Access Code Query</h1>
    <input type="text" id="accessCode" placeholder="Enter access code" value="CRISP-7SLX-STTA">
    <button onclick="testQuery()">Test Query</button>
    <pre id="result"></pre>

    <script>
        const supabaseUrl = 'https://prgkigwehsodsjjigane.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InByZ2tpZ3dlaHNvZHNqamlnYW5lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwODY4NTYsImV4cCI6MjA3NDY2Mjg1Nn0.qnAr1e50KZdat3xt6y0ixWuDvYt2dJnfVtp1EgV9JpI';

        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        async function testQuery() {
            const code = document.getElementById('accessCode').value.toUpperCase().trim();
            const resultDiv = document.getElementById('result');

            resultDiv.textContent = 'Testing...\n';

            // Test 1: Query all interviews
            resultDiv.textContent += '\n=== Test 1: Get ALL interviews ===\n';
            const { data: allInterviews, error: allError } = await supabase
                .from('interviews')
                .select('*');

            resultDiv.textContent += `Result: ${allInterviews ? allInterviews.length + ' interviews found' : 'Error'}\n`;
            if (allError) resultDiv.textContent += `Error: ${JSON.stringify(allError, null, 2)}\n`;
            if (allInterviews) resultDiv.textContent += `Data: ${JSON.stringify(allInterviews, null, 2)}\n`;

            // Test 2: Query with access code only
            resultDiv.textContent += '\n=== Test 2: Query by access_code only ===\n';
            const { data: byCode, error: codeError } = await supabase
                .from('interviews')
                .select('*')
                .eq('access_code', code);

            resultDiv.textContent += `Result: ${byCode ? byCode.length + ' found' : 'Error'}\n`;
            if (codeError) resultDiv.textContent += `Error: ${JSON.stringify(codeError, null, 2)}\n`;
            if (byCode) resultDiv.textContent += `Data: ${JSON.stringify(byCode, null, 2)}\n`;

            // Test 3: Query with access code AND status
            resultDiv.textContent += '\n=== Test 3: Query by access_code + status ===\n';
            const { data: byCodeStatus, error: codeStatusError } = await supabase
                .from('interviews')
                .select('*')
                .eq('access_code', code)
                .eq('status', 'active');

            resultDiv.textContent += `Result: ${byCodeStatus ? byCodeStatus.length + ' found' : 'Error'}\n`;
            if (codeStatusError) resultDiv.textContent += `Error: ${JSON.stringify(codeStatusError, null, 2)}\n`;
            if (byCodeStatus) resultDiv.textContent += `Data: ${JSON.stringify(byCodeStatus, null, 2)}\n`;

            // Test 4: Try .single()
            resultDiv.textContent += '\n=== Test 4: Query with .single() ===\n';
            const { data: single, error: singleError } = await supabase
                .from('interviews')
                .select('*')
                .eq('access_code', code)
                .eq('status', 'active')
                .single();

            resultDiv.textContent += `Result: ${single ? 'Found 1' : 'Error'}\n`;
            if (singleError) resultDiv.textContent += `Error: ${JSON.stringify(singleError, null, 2)}\n`;
            if (single) resultDiv.textContent += `Data: ${JSON.stringify(single, null, 2)}\n`;
        }
    </script>
</body>
</html>